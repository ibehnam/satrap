{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "HierarchicalTodoList",
  "type": "object",
  "additionalProperties": false,
  "required": ["title", "items"],
  "properties": {
    "title": {
      "type": "string",
      "minLength": 1,
      "maxLength": 512
    },
    "context": {
      "type": "string"
    },
    "items": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["number", "text", "depends_on", "done_when"],
        "properties": {
          "number": {
            "type": "string",
            "pattern": "^[1-9]\\d*(\\.[1-9]\\d*)*$",
            "description": "Hierarchical numbering like '1', '1.2', '2.1.3'."
          },
          "text": {
            "type": "string",
            "minLength": 1
          },
          "details": {
            "type": "string",
            "minLength": 1,
            "description": "Long-form instructions/context for this step. Only rendered for items on the active path."
          },
          "depends_on": {
            "type": "array",
            "items": {
              "type": "string",
              "pattern": "^[1-9]\\d*(\\.[1-9]\\d*)*$"
            },
            "uniqueItems": true,
            "default": [],
            "description": "Prerequisite step numbers (e.g. ['1', '2.3'])."
          },
          "done_when": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "string",
              "minLength": 1
            },
            "description": "Acceptance criteria (definition of done)."
          }
        }
      }
    }
  }
}

