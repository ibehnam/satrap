{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/schemas/hierarchical-todo.schema.json",
  "title": "HierarchicalTodoList",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "title",
    "items"
  ],
  "properties": {
    "title": {
      "type": "string",
      "minLength": 1,
      "maxLength": 512
    },
    "context": {
      "type": "string"
    },
    "items": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/$defs/todoItem"
      }
    }
  },
  "$defs": {
    "numbering": {
      "type": "string",
      "pattern": "^[1-9]\\d*(\\.[1-9]\\d*)*$",
      "description": "Hierarchical numbering like '1', '1.2', '2.1.3'."
    },
    "todoItem": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "number",
        "text",
        "depends_on",
        "done_when"
      ],
      "properties": {
        "number": {
          "$ref": "#/$defs/numbering",
          "description": "Todo item index number. Examples: 1, 3.2, 2.1.5, etc."
        },
        "text": {
          "type": "string",
          "minLength": 1
        },
        "details": {
          "type": "string",
          "description": "Long-form instructions/context for this step. Only rendered for items on the active path.",
          "minLength": 1
        },
        "depends_on": {
          "type": "array",
          "description": "Index number of the prerequisite todo item(s) that must be done before doing this item. Example: [\"1\", \"2.3\"]",
          "items": {
            "$ref": "#/$defs/numbering"
          },
          "uniqueItems": true,
          "default": []
        },
        "done_when": {
          "type": "array",
          "description": "Acceptance criteria (definition of done).",
          "minItems": 1,
          "items": {
            "type": "string",
            "minLength": 1
          }
        }
      }
    }
  }
}

